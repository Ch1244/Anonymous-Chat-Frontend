<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Anonymous Chat</title>
  </head>
  <body>
    <div id="chatContainer">
      <div id="header">
        Anonymous Chat
        <button id="themeToggle">Toggle Mode</button>
      </div>
      <div id="statusText">Looking for a partner...</div>
      <div id="messageContainer"></div>
      <div id="inputContainer">
        <textarea
          id="messageInput"
          placeholder="Type a message..."
          rows="1"
        ></textarea>
        <button id="sendButton">âž¤</button>
      </div>
      <canvas id="rocketCanvas"></canvas>
    </div>

    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
      const socket = io("https://anonymous-chat-backend-jquo.onrender.com");
      const username = localStorage.getItem("chatUsername");
      if (username) socket.emit("join", username);

      const messageInput = document.getElementById("messageInput");
      messageInput.addEventListener("input", () => {
        messageInput.style.height = "auto";
        messageInput.style.height = `${messageInput.scrollHeight}px`;
      });

      document
        .getElementById("sendButton")
        .addEventListener("click", sendMessage);
      document
        .getElementById("themeToggle")
        .addEventListener("click", toggleTheme);

      function sendMessage() {
        const message = messageInput.value.trim();
        if (message) {
          socket.emit("message", { username, message });
          displayMessage(`You: ${message}`, "my-message");
          messageInput.value = "";
          messageInput.style.height = "40px";
        }
      }

      socket.on("message", (data) => {
        displayMessage(`${data.username}: ${data.message}`, "partner-message");
      });

      socket.on("system", (msg) => {
        displayMessage(`System: ${msg}`, "system-message");
        if (msg.includes("Connected"))
          document.getElementById("statusText").textContent = "";
      });

      function displayMessage(message, className) {
        const msg = document.createElement("div");
        msg.textContent = message;
        msg.classList.add(className);
        document.getElementById("messageContainer").appendChild(msg);
        document.getElementById("messageContainer").scrollTop =
          document.getElementById("messageContainer").scrollHeight;
      }

      function toggleTheme() {
        document.body.classList.toggle("light-mode");
      }

      // Rocket animation every 10 seconds
      const canvas = document.getElementById("rocketCanvas");
      const ctx = canvas.getContext("2d");

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      function drawRocket() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#00ffcc";
        ctx.beginPath();
        ctx.moveTo(0, canvas.height);
        ctx.lineTo(canvas.width, 0);
        ctx.lineWidth = 2;
        ctx.stroke();
      }

      setInterval(drawRocket, 10000);
    </script>
  </body>
</html>
