<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Anonymous Chat</title>
  </head>
  <body>
    <div id="chatContainer">
      <div id="header">Anonymous Chat</div>
      <div id="statusText">Looking for a partner...</div>
      <div id="messageContainer"></div>
      <div id="inputContainer">
        <textarea
          id="messageInput"
          placeholder="Type a message..."
          rows="1"
        ></textarea>
        <button id="sendButton">âž¤</button>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
      const socket = io("https://your-backend-url.onrender.com");
      const username = localStorage.getItem("chatUsername");
      if (username) socket.emit("join", username);

      const messageInput = document.getElementById("messageInput");
      messageInput.addEventListener("input", () => {
        messageInput.style.height = "auto";
        messageInput.style.height = `${messageInput.scrollHeight}px`;
      });

      document
        .getElementById("sendButton")
        .addEventListener("click", sendMessage);

      function sendMessage() {
        const message = messageInput.value.trim();
        if (message) {
          socket.emit("message", { username, message });
          displayMessage(`You: ${message}`);
          messageInput.value = "";
          messageInput.style.height = "40px";
        }
      }

      socket.on("message", (data) => {
        displayMessage(`${data.username}: ${data.message}`);
      });

      socket.on("system", (msg) => {
        displayMessage(`System: ${msg}`);
        if (msg.includes("Connected"))
          document.getElementById("statusText").textContent = "";
      });

      function displayMessage(message) {
        const msg = document.createElement("div");
        msg.textContent = message;
        document.getElementById("messageContainer").appendChild(msg);
        document.getElementById("messageContainer").scrollTop =
          document.getElementById("messageContainer").scrollHeight;
      }
    </script>
  </body>
</html>
