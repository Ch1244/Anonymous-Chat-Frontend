<!-- video.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>Video Chat</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1 class="neon-blue">ðŸŽ¥ Video Chat</h1>
    <video id="localVideo" autoplay muted></video>
    <video id="remoteVideo" autoplay></video>
    <button id="startCall">Start Call</button>

    <script src="https://anonymous-chat-backend-jquo.onrender.com/socket.io/socket.io.js"></script>
    <script>
      const socket = io("https://anonymous-chat-backend-jquo.onrender.com");
      let peerConnection;

      const localVideo = document.getElementById("localVideo");
      const remoteVideo = document.getElementById("remoteVideo");

      // Access camera
      navigator.mediaDevices
        .getUserMedia({ video: true, audio: true })
        .then((stream) => {
          localVideo.srcObject = stream;
          socket.emit("join-room", "video-room");
        });

      // WebRTC Handling
      socket.on("user-connected", async (partnerId) => {
        const offer = await peerConnection.createOffer();
        await peerConnection.setLocalDescription(offer);
        socket.emit("offer", { target: partnerId, offer });
      });

      socket.on("offer", async (payload) => {
        await peerConnection.setRemoteDescription(
          new RTCSessionDescription(payload.offer)
        );
        const answer = await peerConnection.createAnswer();
        await peerConnection.setLocalDescription(answer);
        socket.emit("answer", { target: payload.target, answer });
      });

      socket.on("answer", async (payload) => {
        await peerConnection.setRemoteDescription(
          new RTCSessionDescription(payload.answer)
        );
      });

      socket.on("ice-candidate", async (incoming) => {
        try {
          await peerConnection.addIceCandidate(new RTCIceCandidate(incoming));
        } catch (e) {
          console.error("Error adding ice candidate:", e);
        }
      });
    </script>
  </body>
</html>
